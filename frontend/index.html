<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Human Certified AI Detector</title>
<link rel="manifest" href="manifest.json">
<style>
body { font-family: Arial, sans-serif; padding: 2rem; background: #1A237E; color: #fff; }
h1 { text-align: center; color: #E0E0FF; }
#dropArea, #videoDropArea { 
    border: 2px dashed #aaa; padding: 2rem; text-align: center; cursor: pointer; 
    background: #283593; border-radius: 8px; transition: 0.3s; color: #E0E0FF; margin-bottom: 1rem;
}
#dropArea.dragover, #videoDropArea.dragover { border-color: #fff; background: #3949AB; }

.itemContainer, .videoCard {
    background: #303F9F; padding: 1rem; border-radius: 8px; margin-top: 1.5rem;
    box-shadow: 0 2px 6px rgba(0,0,0,0.4); text-align: center;
}

.previewImg { max-width: 200px; border-radius: 8px; margin-bottom: 0.5rem; }
.spinner { font-weight: bold; color: #FFD54F; margin-top: 0.5rem; }
.resultLabel { font-size: 1.3rem; font-weight: bold; margin-top: 0.3rem; }
.confidencePercent { font-weight: bold; margin-top: 0.3rem; }
.barContainer { width: 100%; height: 20px; background: #5C6BC0; border-radius: 10px; overflow: hidden; margin-top: 0.3rem; margin-bottom: 0.3rem; }
.bar { height: 100%; width: 0%; border-radius: 10px; transition: width 1s ease; }
</style>
</head>
<body>

<h1>Human Certified AI Detector</h1>

<!-- Image Upload -->
<div id="dropArea">Click or drag images here</div>
<input type="file" id="fileInput" style="display:none" accept="image/*" multiple />
<div id="results"></div>

<!-- Video Upload -->
<h2 style="text-align:center;">Video AI Detector</h2>
<div id="videoDropArea">Click or drag a video here</div>
<input type="file" id="videoInput" style="display:none" accept="video/mp4,video/mov,video/webm" />
<video id="videoPreview" controls style="max-width:300px; display:none; border-radius:8px; margin-bottom:1rem;"></video>
<div id="videoSpinner" style="display:none; font-weight:bold; color:#FFD54F;">ðŸ”„ Analyzing video...</div>
<div id="videoResultCard" class="videoCard" style="display:none;">
    <div id="videoFinalResult" style="font-size:1.3rem; font-weight:bold;"></div>
    <div id="videoFrameBreakdown" style="margin-top:0.5rem; font-size:0.9rem;"></div>
</div>

<script>
const HUGGINGFACE_BACKEND = "https://https://huggingface.co/spaces/SpaceCowOfKarhide/human-certified-detector"; // <-- replace with your HF URL

function getVerdictColor(aiConfidence) {
    if (aiConfidence >= 60) return {verdict:"AI-generated", color:"#9C27B0"};
    else if (aiConfidence >= 30) return {verdict:"Mixed / AI-Assisted", color:"#FFD54F"};
    else return {verdict:"Human-made", color:"#43B48C"};
}

/* ------------------ IMAGE ------------------ */
const dropArea = document.getElementById("dropArea");
const fileInput = document.getElementById("fileInput");
const resultsDiv = document.getElementById("results");

dropArea.addEventListener("click", () => fileInput.click());
fileInput.addEventListener("change", () => handleFiles(fileInput.files));
dropArea.addEventListener("dragover", e => { e.preventDefault(); dropArea.classList.add("dragover"); });
dropArea.addEventListener("dragleave", () => dropArea.classList.remove("dragover"));
dropArea.addEventListener("drop", e => { e.preventDefault(); dropArea.classList.remove("dragover"); handleFiles(e.dataTransfer.files); });

function handleFiles(files) { for (const file of files) processFile(file); }

async function processFile(file) {
    const container = document.createElement("div");
    container.className = "itemContainer";
    container.innerHTML = `
        <img class="previewImg" />
        <div class="spinner">ðŸ”„ Analyzing...</div>
        <div class="resultLabel"></div>
        <div class="confidencePercent"></div>
        <div class="barContainer"><div class="bar"></div></div>
    `;
    resultsDiv.prepend(container);

    const imgEl = container.querySelector(".previewImg");
    const spinner = container.querySelector(".spinner");
    const resultLabel = container.querySelector(".resultLabel");
    const confidencePercent = container.querySelector(".confidencePercent");
    const bar = container.querySelector(".bar");

    const reader = new FileReader();
    reader.onload = () => imgEl.src = reader.result;
    reader.readAsDataURL(file);

    const formData = new FormData();
    formData.append("file", file);

    try {
        const res = await fetch(https://huggingface.co/spaces/SpaceCowOfKarhide/human-certified-detector { method: "POST", body: formData });
        const data = await res.json();
        spinner.style.display = "none";

        const aiConfidence = data.ai_generated_confidence || 50; // fallback
        const vc = getVerdictColor(aiConfidence);
        resultLabel.textContent = vc.verdict;
        resultLabel.style.color = vc.color;

        confidencePercent.textContent = `AI: ${data.ai_generated_confidence}% â€¢ Human: ${data.human_made_confidence}%`;
        bar.style.background = vc.color;
        setTimeout(() => { bar.style.width = data.ai_generated_confidence + "%"; }, 100);

    } catch (err) {
        spinner.textContent = "âš ï¸ Error contacting backend";
        console.error(err);
    }
}

/* ------------------ VIDEO ------------------ */
const videoDropArea = document.getElementById("videoDropArea");
const videoInput = document.getElementById("videoInput");
const videoPreview = document.getElementById("videoPreview");
const videoSpinner = document.getElementById("videoSpinner");
const videoResultCard = document.getElementById("videoResultCard");
const videoFinalResult = document.getElementById("videoFinalResult");
const videoFrameBreakdown = document.getElementById("videoFrameBreakdown");

videoDropArea.addEventListener("click", () => videoInput.click());
videoDropArea.addEventListener("dragover", e => { e.preventDefault(); videoDropArea.classList.add("dragover"); });
videoDropArea.addEventListener("dragleave", () => videoDropArea.classList.remove("dragover"));
videoDropArea.addEventListener("drop", e => { e.preventDefault(); videoDropArea.classList.remove("dragover"); if(e.dataTransfer.files.length>0) processVideo(e.dataTransfer.files[0]); });
videoInput.addEventListener("change", () => { if(videoInput.files.length>0) processVideo(videoInput.files[0]); });

async function processVideo(file){
    videoPreview.style.display="none";
    videoResultCard.style.display="none";
    videoSpinner.style.display="block";

    const url = URL.createObjectURL(file);
    videoPreview.src = url;
    videoPreview.style.display="block";

    const formData = new FormData();
    formData.append("file", file);

    try{
        const res = await fetch(https://huggingface.co/spaces/SpaceCowOfKarhide/human-certified-detector, { method: "POST", body: formData });
        const data = await res.json();
        videoSpinner.style.display="none";
        videoResultCard.style.display="block";

        const aiConfidence = data.ai_ratio || 50; // fallback
        const vc = getVerdictColor(aiConfidence);
        videoFinalResult.textContent=`${vc.verdict} (Avg: ${data.avg_confidence || 'N/A'})`;
        videoFinalResult.style.color=vc.color;
        videoFrameBreakdown.textContent=`AI frames: ${data.ai_frames || 0} â€¢ Human frames: ${data.human_frames || 0} â€¢ Total: ${data.total_frames_analyzed || 0}`;
    } catch(err){
        videoSpinner.textContent="âš ï¸ Error contacting backend";
        console.error(err);
    }
}

/* ------------------ SERVICE WORKER ------------------ */
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('service-worker.js')
      .then(reg => console.log('Service Worker Registered:', reg.scope))
      .catch(err => console.error('Service Worker registration failed:', err));
  });
}
</script>
</body>
</html>
